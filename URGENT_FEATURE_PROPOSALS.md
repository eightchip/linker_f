# 🔥 緊急性・重要度の高い機能追加提案（整理版）

## ✅ 実装済み機能（除外）

以下の機能は既に実装済みのため、提案から除外します：

1. **タスクカード：期限日までの残り日数表示** ✅
   - `_getRemainingDaysText`メソッドで「あとN日」「今日」「N日超過」を表示
   - `_buildDeadlineIndicator`で視覚的に表示済み

2. **タスク検索バー：検索候補の自動補完** ✅
   - `_updateSearchSuggestions`で検索履歴とタスクタイトルから候補を表示
   - `_buildSearchSuggestions`で候補リストを表示済み

3. **予定の重複チェック機能（基本）** ✅
   - `_checkScheduleOverlap`で重複チェックを実装済み
   - 予定表画面で重複予定を視覚的に表示済み

4. **データ整合性チェック・修復機能（基本）** ✅
   - `MigrationService.validateDataIntegrity`でチェック機能あり
   - `MigrationService.repairCorruptedData`で修復機能あり

5. **自動バックアップ機能（基本）** ✅
   - `BackupService.checkAndPerformAutoBackup`で自動バックアップ機能あり
   - 起動時の自動バックアップチェック実装済み

---

## 🚨 優先度：最優先（即座に実装必須）

### 1. Outlookクラッシュ対策の強化
**現状の問題**:
- Outlook自動取り込み時にOutlookが落ちる問題が発生
- エラーハンドリングが不十分
- PowerShellスクリプトの実行中にOutlookが不安定

**提案**:
- **タイムアウト設定**: PowerShell実行にタイムアウトを設定（デフォルト30秒）
- **プロセス監視**: Outlookプロセスが応答しているか確認してから操作
- **再試行機構**: 失敗時の自動再試行（最大3回、指数バックオフ）
- **ログ強化**: クラッシュ原因を特定できる詳細ログ出力
- **Quit()の追加**: 処理後にOutlookを明示的に終了（既存のReleaseComObjectに加えて）
- **フォールバック処理**: Outlookが利用できない場合の適切なメッセージ表示

**実装難易度**: 中
**期待効果**: Outlookのクラッシュ防止、安定性向上
**ビジネスインパクト**: ⭐⭐⭐⭐⭐（ユーザー体験に直接影響）

**実装場所**: `lib/services/outlook_calendar_service.dart`, `lib/services/outlook_auto_sync_service.dart`

---

### 2. データ整合性チェック・自動修復機能の強化
**現状の問題**:
- 起動時の整合性チェックが無効化されている（`main.dart`でコメントアウト）
- タスクと予定の関連性チェックが不足
- 孤立した予定の検出・修復機能がない

**提案**:
- **起動時整合性チェックの有効化**: `main.dart`の`_initializeDataMigration`を有効化
- **予定の整合性チェック追加**: 
  - 存在しないタスクIDに紐づく予定を検出・修復
  - 孤立した予定を専用の「孤立予定」タスクに移動
- **整合性チェックダイアログ**: 問題が検出された場合にユーザーに通知
- **手動チェック機能**: 設定画面から手動で整合性チェックを実行
- **修復前のバックアップ**: 修復実行前に自動バックアップを実行

**実装難易度**: 中
**期待効果**: データ損失防止、システムの安定性向上
**ビジネスインパクト**: ⭐⭐⭐⭐⭐（データ保護は最重要）

**実装場所**: `lib/services/migration_service.dart`, `lib/main.dart`, `lib/views/settings_screen.dart`

---

### 3. 自動バックアップの強化・多重化
**現状の問題**:
- バックアップが1箇所にのみ保存される
- 重要な操作前の自動バックアップがない
- バックアップ失敗時の通知が不十分

**提案**:
- **操作前自動バックアップ**: 
  - 大量削除（一括削除、10件以上）前の自動バックアップ
  - データインポート前の自動バックアップ
  - タスク結合前の自動バックアップ
- **複数場所への保存**: 
  - ローカル（既存）+ ユーザー指定フォルダへの自動コピー
  - 設定画面でバックアップ保存先を追加指定可能に
- **バックアップ検証**: バックアップファイルの整合性チェック（JSON形式の検証）
- **バックアップ失敗時の警告**: 重要な操作前のバックアップ失敗時は操作を中断するオプション
- **バックアップ履歴管理**: バックアップ一覧と復元機能の強化（UI改善）

**実装難易度**: 中
**期待効果**: データ損失リスクの最小化
**ビジネスインパクト**: ⭐⭐⭐⭐⭐（データ保護は最重要）

**実装場所**: `lib/services/backup_service.dart`, `lib/views/task_screen.dart`, `lib/views/settings_screen.dart`

---

## 🔥 優先度：高（早期実装推奨）

### 4. タスク編集モーダル：入力欄のフォーカス改善・入力体験向上
**現状の問題**:
- メモ欄や説明欄でカーソルがスキップする現象
- 入力欄間の移動がスムーズでない
- Tabキーでの移動が期待通りに動作しない場合がある

**提案**:
- `TextField`の`enableInteractiveSelection: true`を明示的に設定
- `TextInputAction.next`で次の入力欄へ自動移動
- フォーカス時の視覚的フィードバック強化（ボーダー色変更、アニメーション）
- Ctrl+Enter で保存（よく使う操作のショートカット）
- 入力中の自動保存機能（オプション、設定でON/OFF）

**実装難易度**: 低
**期待効果**: 入力ストレスの削減、編集効率の向上
**ビジネスインパクト**: ⭐⭐⭐⭐（日常的なUX向上）

**実装場所**: `lib/views/task_dialog.dart`

---

### 5. 予定の重複チェック・警告機能の強化
**現状の問題**:
- 重複チェック機能はあるが、予定追加時の警告ダイアログがない
- 重複予定の一覧表示機能がない
- ユーザーが重複に気づきにくい

**提案**:
- **予定追加時の重複警告ダイアログ**: 
  - 予定追加時に重複が検出された場合、警告ダイアログを表示
  - 「それでも追加する」「キャンセル」の選択肢
  - 重複している予定の詳細を表示
- **重複予定一覧表示**: 
  - 設定画面や予定表から重複予定の一覧を確認
  - 重複予定の解決を支援（削除、時間変更の提案）
- **重複予定の視覚的強調**: 
  - 予定表画面で重複予定をより目立つように表示（赤枠、警告アイコン）

**実装難易度**: 中
**期待効果**: スケジュール管理の精度向上、予定の見落とし防止
**ビジネスインパクト**: ⭐⭐⭐⭐（業務効率に直接影響）

**実装場所**: `lib/views/task_dialog.dart`, `lib/views/schedule_calendar_screen.dart`, `lib/views/settings_screen.dart`

---

### 6. タスク検索バー：検索候補の自動補完の強化
**現状の問題**:
- 基本的な自動補完は実装済みだが、以下の機能が不足：
  - タグ、説明文からの候補表示
  - 検索候補のハイライト表示（マッチ部分を強調）
  - 頻度順ソートの改善

**提案**:
- **検索範囲の拡張**: 
  - タグ、説明文からの候補も表示（オプション、設定でON/OFF）
  - 検索履歴の頻度順でソート（現在は時系列順の可能性）
- **検索候補のハイライト表示**: 
  - マッチ部分を太字や背景色で強調
  - より直感的な候補選択
- **キーボード操作の改善**: 
  - 矢印キーでの候補選択をよりスムーズに
  - Tabキーでの候補選択

**実装難易度**: 中
**期待効果**: 検索効率のさらなる向上、タイプミス削減
**ビジネスインパクト**: ⭐⭐⭐⭐（日常的なUX向上）

**実装場所**: `lib/views/task_screen.dart`（`_updateSearchSuggestions`, `_buildSearchSuggestions`メソッド）

---

## ⚡ 優先度：中（次期実装推奨）

### 7. タスク管理画面：フィルターの保存・読み込み機能強化
**現状の問題**:
- フィルター設定は自動保存されるが、名前を付けて保存できない
- よく使うフィルターの組み合わせを素早く適用できない
- 複数のフィルターパターンを切り替えられない

**提案**:
- **名前付きフィルター保存**: 
  - 現在のフィルター設定に名前を付けて保存（例：「今週の緊急タスク」「プロジェクトA関連」）
  - 保存したフィルターをドロップダウンから選択して適用
- **フィルターの共有**: 
  - 保存したフィルターを設定ファイルとしてエクスポート
  - 他のユーザーや環境でフィルターをインポート
- **クイックフィルター**: 
  - よく使うフィルターをクイックアクセスバーに配置
  - ワンクリックでフィルター適用

**実装難易度**: 中
**期待効果**: 作業効率の大幅向上、繰り返し作業の自動化
**ビジネスインパクト**: ⭐⭐⭐（効率化）

**実装場所**: `lib/views/task_screen.dart`（`_loadSavedFilterPresets`メソッドの拡張）

---

### 8. タスクカード：ドラッグ&ドロップによる優先順位変更
**現状の問題**:
- タスクの優先順位を視覚的に調整できない
- 並び替えはソート機能に依存
- 直感的な優先順位管理ができない

**提案**:
- タスクカードをドラッグ&ドロップで並び替え可能に
- 並び替え順序を保存（カスタム順序フィールド）
- 並び替えモードのトグルボタン追加（「手動順序モード」）
- 手動順序と自動ソートの切り替え機能

**実装難易度**: 中
**期待効果**: 直感的な優先順位管理、作業フローの最適化
**ビジネスインパクト**: ⭐⭐⭐（UX向上）

**実装場所**: `lib/views/task_screen.dart`, `lib/models/task_item.dart`（順序フィールドの追加）

---

### 9. タスク管理画面：バルク編集機能の拡張
**現状の問題**:
- 一括操作は削除・ステータス変更・優先度変更のみ
- 期限日やタグの一括変更ができない
- 大量のタスク管理が非効率

**提案**:
- **一括期限日変更**: 選択したタスクの期限日を一括変更
- **一括タグ操作**: 選択したタスクにタグを一括追加・削除
- **一括リンク割り当て**: 選択したタスクを一括でリンクに割り当て
- **一括説明・メモ追加**: 選択したタスクに説明やメモを一括追加（既存の内容に追記）

**実装難易度**: 中
**期待効果**: 大量タスクの管理効率化、作業時間の短縮
**ビジネスインパクト**: ⭐⭐⭐（効率化）

**実装場所**: `lib/views/task_screen.dart`（一括操作メニューの拡張）

---

## 📊 実装優先順位の推奨

### フェーズ1（最優先・即座に実装）
1. **Outlookクラッシュ対策の強化** - 安定性問題を解決
2. **データ整合性チェック・自動修復機能の強化** - データ保護
3. **自動バックアップの強化・多重化** - データ保護

### フェーズ2（早期実装・高優先度）
4. **タスク編集モーダル：入力欄のフォーカス改善** - UX向上（実装簡単）
5. **予定の重複チェック・警告機能の強化** - 業務効率向上
6. **タスク検索バー：検索候補の自動補完の強化** - UX向上

### フェーズ3（次期実装・中優先度）
7. **タスク管理画面：フィルターの保存・読み込み機能強化**
8. **タスクカード：ドラッグ&ドロップによる優先順位変更**
9. **タスク管理画面：バルク編集機能の拡張**

---

## 💡 実装時の注意事項

- **スキーマ変更禁止**: すべて既存のデータ構造を使用（必要に応じてHive拡張は可）
- **後方互換性**: 既存の機能に影響を与えない
- **パフォーマンス**: 大量データでも動作を維持
- **エラーハンドリング**: エラー時もアプリがクラッシュしないように適切な処理
- **ユーザビリティ**: 直感的で分かりやすいUIを心がける
- **ログ出力**: デバッグとトラブルシューティングのための詳細ログ
- **テスト**: 重要な機能は十分なテストを実施

---

## 🎯 期待される効果のまとめ

### 安定性向上
- Outlookクラッシュ問題の解決
- データ整合性の保証
- バックアップの強化

### ユーザー体験向上
- 入力体験の改善
- 検索効率の向上
- 予定管理の精度向上

### 業務効率向上
- フィルターの活用
- バルク操作の拡張
- 優先順位管理の改善

---

**作成日**: 2025年
**更新日**: 2025年
**優先度**: 最優先機能の実装を強く推奨
